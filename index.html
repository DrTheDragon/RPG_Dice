<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<link rel="icon" type="image/svg+xml" href="favicon.svg">
<title>Teste RPG</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet">

<style>
:root{
 --bg1:#111;--bg2:#000;--panel:#080808;--text:#e0e0e0;
 --border:#222;
}
body.light{
 --bg1:#e6e6e6;--bg2:#cfcfcf;--panel:#f5f5f5;--text:#111;
 --border:#bbb;
}

@keyframes roll{
 0%{transform:rotate(0) scale(1)}
 30%{transform:rotate(25deg) scale(1.05)}
 60%{transform:rotate(-20deg) scale(1.05)}
 100%{transform:rotate(0) scale(1)}
}
.dado.rolando{animation:roll .35s ease-in-out}

body{
 background:radial-gradient(circle at top,var(--bg1),var(--bg2));
 color:var(--text);
 font-family:'Special Elite',monospace;
 margin:0;min-height:100vh;
 display:flex;justify-content:center;align-items:center;
}
.wrapper{width:100%;display:flex;flex-direction:column;align-items:center}
.app{display:grid;grid-template-columns:1fr 1fr;gap:20px;width:820px;max-width:95%}
.panel{
 background:var(--panel);
 border:1px solid var(--border);
 box-shadow:0 0 40px rgba(0,0,0,.7);
 padding:25px
}
h2,h3{text-align:center;letter-spacing:2px}
.section{border-top:1px solid var(--border);margin-top:20px;padding-top:15px}

input,button,textarea{
 width:100%;padding:10px;margin-top:8px;
 background:transparent;border:1px solid var(--border);
 color:var(--text);text-align:center;
 font-family:'Special Elite',monospace;
 font-size:15px
}
textarea{min-height:140px;text-align:left}
button{cursor:pointer}
button:hover{background:rgba(255,255,255,.05)}
button:active{transform:scale(.97)}

.dado{font-size:58px;text-align:center;margin:10px 0}
.resultado{min-height:90px;text-align:center;margin-top:10px}

.controls{display:flex;gap:6px;flex-wrap:wrap}
.controls button{flex:1 1 48%}

.E{color:#ff4c4c}
.B{color:#4fa3ff}
.N{color:#9acd32}
.F{color:#777}

.historico{margin-top:15px;font-size:14px}
.historico ul{list-style:none;padding:0;margin:0}
.historico li{padding:6px;border-bottom:1px solid var(--border)}
.fade-0{color:var(--text)}
.fade-1{color:#aaa}
.fade-2{color:#888}
.fade-3{color:#666}

.toggle{
 margin-bottom:15px;
 width:820px;
 max-width:95%;
 text-align:right;
}

.itens{width:820px;max-width:95%;margin-top:25px}

@media(max-width:768px){
 body{align-items:flex-start}
 .app{grid-template-columns:1fr}
}
</style>
</head>

<body>
<div class="wrapper">

<div class="toggle">
<button onclick="toggleTema()">üåó Alternar Tema</button>
</div>

<div class="app">

<div class="panel">
<h2>TESTES</h2>

<div class="section">
<h3>Teste de Atributo</h3>
<input id="atributo" type="number" min="1" max="20" placeholder="Atributo (1‚Äì20)">
<div class="dado">üé≤</div>
<button onclick="testeAtributo()">ROLAR D20</button>
<div class="resultado" id="resAtributo"></div>

<div class="historico">
<h3>üìú Hist√≥rico</h3>
<ul id="listaHistorico"></ul>
</div>
</div>

<div class="section">
<h3>Teste de Sanidade</h3>
<div class="dado">üé≤</div>
<button onclick="testeSanidade()">ROLAR D100</button>
<div class="resultado" id="resSan"></div>

<div class="historico">
<h3>üß† Hist√≥rico de Sanidade</h3>
<ul id="listaHistoricoSan"></ul>
</div>
</div>
</div>

<div class="panel">
<h2>STATUS</h2>

<div class="section">
  <h4>Chances de Sobreviv√™ncia</h4>
  <div style="display:flex;gap:12px;justify-content:center">
    <input type="checkbox" id="vidaChk1">
    <input type="checkbox" id="vidaChk2">
    <input type="checkbox" id="vidaChk3">
  </div>

  <hr style="border:1px solid var(--border);margin:12px 0">

  <h4>Condi√ß√£o</h4>
  <div style="display:flex;gap:20px;justify-content:center">
    <label><input type="checkbox" id="ferido"> ü©∏ Extremamente Ferido</label>
    <label><input type="checkbox" id="caido"> ‚ò† Ca√≠do</label>
  </div>
</div>
 
<div class="controls">
<button onclick="alterar('vida',-1)">-1</button>
<button onclick="alterar('vida',1)">+1</button>
<button onclick="alterar('vida',-5)">-5</button>
<button onclick="alterar('vida',5)">+5</button>
</div>
</div>

<div class="section">
<h3>Sanidade</h3>
<input id="sanMax" type="number" placeholder="Sanidade M√°xima">
<p>Atual: <b><span id="sanAtual">0</span></b></p>
<div class="controls">
<button onclick="alterar('san',-1)">-1</button>
<button onclick="alterar('san',1)">+1</button>
<button onclick="alterar('san',-5)">-5</button>
<button onclick="alterar('san',5)">+5</button>
</div>
</div>

</div>
</div>

 <div class="panel itens">
  <h2>CONDI√á√ïES & REGISTROS</h2>
  <div class="section">
    <h3>Horas de Sono</h3>
    <p><b><span id="sonoAtual">0</span> horas</b></p>
    <div class="controls">
      <button onclick="alterarSono(-1)">-1</button>
      <button onclick="alterarSono(1)">+1</button>
      <button onclick="alterarSono(-3)">-3</button>
      <button onclick="alterarSono(3)">+3</button>
    </div>
  </div>


   <div class="section">
    <h3>üí∞ Dinheiro</h3>
    <input id="dinheiro" type="number" placeholder="Dinheiro atual">
  </div>

  <div class="section">
    <h3>üß† Traumas</h3>
    <textarea id="traumas" placeholder="Medos, choques, cicatrizes mentais..."></textarea>
  </div>

  <div class="section">
    <h3>‚≠ê Vantagens</h3>
    <textarea id="vantagens" placeholder="Habilidades, contatos, vantagens especiais..."></textarea>
  </div>

  <div class="panel itens">
<h2>ITENS / ACESS√ìRIOS</h2>
<textarea id="itens" placeholder="Anota aqui armas, pistas, acess√≥rios, contatos, segredos..."></textarea>
  </div>
</div>
 
</div>

<script>
function somDado(){
 const ctx=new (window.AudioContext||webkitAudioContext)();
 let t=ctx.currentTime;
 for(let i=0;i<8;i++){
  const o=ctx.createOscillator(),g=ctx.createGain();
  o.frequency.value=120+Math.random()*400;
  g.gain.setValueAtTime(.15,t);
  g.gain.exponentialRampToValueAtTime(.001,t+.08);
  o.connect(g).connect(ctx.destination);
  o.start(t);o.stop(t+.08);t+=.04;
 }
}

let historico=[];
let historicoSan=[];

const tabela={
1:{N:20,B:null,E:null},2:{N:19,B:20,E:null},
3:{N:18,B:20,E:null},4:{N:17,B:19,E:null},
5:{N:16,B:19,E:20},6:{N:15,B:18,E:20},
7:{N:14,B:18,E:20},8:{N:13,B:17,E:20},
9:{N:12,B:17,E:20},10:{N:11,B:16,E:19},
11:{N:10,B:16,E:19},12:{N:9,B:15,E:19},
13:{N:8,B:15,E:19},14:{N:7,B:14,E:19},
15:{N:6,B:14,E:18},16:{N:5,B:13,E:18},
17:{N:4,B:13,E:18},18:{N:3,B:12,E:18},
19:{N:2,B:12,E:18},20:{N:1,B:11,E:17}
};

function testeAtributo(){
 somDado();
 let att=parseInt(atributo.value)||1;
 att=Math.min(20,Math.max(1,att));
 atributo.value=att;

 const dadoEl=document.querySelectorAll(".dado")[0];
 dadoEl.classList.add("rolando");
 setTimeout(()=>dadoEl.classList.remove("rolando"),350);

 const d=Math.floor(Math.random()*20)+1;
 let t,c;

 if(d===1){t="FALHA CR√çTICA";c="F";}
 else{
  const r=tabela[att];
  if(r.E&&d>=r.E){t="EXTREMO";c="E";}
  else if(r.B&&d>=r.B){t="BOM";c="B";}
  else if(d>=r.N){t="NORMAL";c="N";}
  else{t="FALHA";c="F";}
 }

 resAtributo.innerHTML=
 `üé≤ ${d}<br>üìä Atributo ${att}<br><span class="${c}"><b>${t}</b></span>`;

 historico.unshift(`üé≤ ${d} | Atributo ${att} ‚Üí ${t}`);
 if(historico.length>6)historico.pop();
 salvar();atualizarHistorico();
}

function testeSanidade(){
 somDado();

 const dadoEl=document.querySelectorAll(".dado")[1];
 dadoEl.classList.add("rolando");
 setTimeout(()=>dadoEl.classList.remove("rolando"),350);

 const sanMaxVal=Math.max(0,+sanMax.value||0);
 sanMax.value=sanMaxVal;

 const d=Math.floor(Math.random()*100)+1;
 const ok=d>=sanMaxVal;
 const r=ok?"SUCESSO":"FALHA";

 resSan.innerHTML=`üé≤ ${d}<br><span class="${ok?'N':'F'}"><b>${r}</b></span>`;

 historicoSan.unshift(`üß† ${d} / San M√°x: ${sanMaxVal} ‚Üí ${r}`);
 if(historicoSan.length>6)historicoSan.pop();
 salvar();atualizarHistoricoSan();
}

function atualizarHistorico(){
 listaHistorico.innerHTML="";
 historico.forEach((h,i)=>{
  const li=document.createElement("li");
  li.className=i<3?"fade-0":i===3?"fade-1":i===4?"fade-2":"fade-3";
  li.textContent=h;
  listaHistorico.appendChild(li);
 });
}
function atualizarHistoricoSan(){
 listaHistoricoSan.innerHTML="";
 historicoSan.forEach((h,i)=>{
  const li=document.createElement("li");
  li.className=i<3?"fade-0":i===3?"fade-1":i===4?"fade-2":"fade-3";
  li.textContent=h;
  listaHistoricoSan.appendChild(li);
 });
}

let vida=0,san=0;
function salvar(){
 localStorage.setItem("noir",JSON.stringify({
  vida,san,
  vidaMax:Math.max(0,+vidaMax.value||0),
  sanMax:Math.max(0,+sanMax.value||0),
  itens:itens.value,
  historico,
  historicoSan,
  tema:document.body.className
 }));
}
function carregar(){
 const d=JSON.parse(localStorage.getItem("noir"));if(!d)return;
 vida=d.vida||0;san=d.san||0;
 vidaMax.value=Math.max(0,d.vidaMax||0);
 sanMax.value=Math.max(0,d.sanMax||0);
 itens.value=d.itens||"";
 historico=d.historico||[];
 historicoSan=d.historicoSan||[];
 if(d.tema)document.body.className=d.tema;
 atualizar();atualizarHistorico();atualizarHistoricoSan();
}
function atualizar(){vidaAtual.textContent=vida;sanAtual.textContent=san}
function alterar(t,v){
 if(t==="vida")vida=Math.max(0,Math.min(+vidaMax.value,vida+v));
 else san=Math.max(0,Math.min(+sanMax.value,san+v));
 salvar();atualizar();
}

vidaMax.onchange=()=>{
 vidaMax.value=Math.max(0,+vidaMax.value||0);
 vida=vidaMax.value;
 salvar();atualizar();
};
sanMax.onchange=()=>{
 sanMax.value=Math.max(0,+sanMax.value||0);
 san=sanMax.value;
 salvar();atualizar();
};

itens.oninput=salvar;

function toggleTema(){
 document.body.classList.toggle("light");
 salvar();
}

carregar();
/* ===== EXTENS√ïES DE STATUS ===== */

let sono = 0;

function alterarSono(v){
  sono = Math.max(0, sono + v);
  document.getElementById("sonoAtual").textContent = sono;
  salvar();
}

/* estende o salvar() sem quebrar o original */
const salvarOriginal = salvar;
salvar = function(){
  salvarOriginal();
  const dados = JSON.parse(localStorage.getItem("noir")) || {};
  dados.sono = sono;
  dados.dinheiro = document.getElementById("dinheiro").value;
  dados.traumas = document.getElementById("traumas").value;
  dados.vantagens = document.getElementById("vantagens").value;
  dados.condicoes = [
    document.getElementById("cond1").checked,
    document.getElementById("cond2").checked,
    document.getElementById("cond3").checked
  ];
  localStorage.setItem("noir", JSON.stringify(dados));
};

/* estende o carregar() sem quebrar o original */
const carregarOriginal = carregar;
carregar = function(){
  carregarOriginal();
  const dados = JSON.parse(localStorage.getItem("noir"));
  if(!dados) return;

  sono = dados.sono || 0;
  document.getElementById("sonoAtual").textContent = sono;

  document.getElementById("dinheiro").value = dados.dinheiro || "";
  document.getElementById("traumas").value = dados.traumas || "";
  document.getElementById("vantagens").value = dados.vantagens || "";

  if(dados.condicoes){
    document.getElementById("cond1").checked = dados.condicoes[0];
    document.getElementById("cond2").checked = dados.condicoes[1];
    document.getElementById("cond3").checked = dados.condicoes[2];
  }
};

/* autosave */
["dinheiro","traumas","vantagens","cond1","cond2","cond3"]
.forEach(id=>{
  document.getElementById(id).addEventListener("input",salvar);
  document.getElementById(id).addEventListener("change",salvar);
});
 /* ===== CHECKBOX DE VIDA (SOBREVIV√äNCIA) ===== */

const vidaChecks = ["vidaChk1","vidaChk2","vidaChk3"];

/* estende salvar */
const salvarVidaChk = salvar;
salvar = function(){
  salvarVidaChk();
  const dados = JSON.parse(localStorage.getItem("noir")) || {};
  dados.vidaChecks = vidaChecks.map(id => document.getElementById(id).checked);
  localStorage.setItem("noir", JSON.stringify(dados));
};

/* estende carregar */
const carregarVidaChk = carregar;
carregar = function(){
  carregarVidaChk();
  const dados = JSON.parse(localStorage.getItem("noir"));
  if(!dados || !dados.vidaChecks) return;
  vidaChecks.forEach((id,i)=>{
    document.getElementById(id).checked = dados.vidaChecks[i];
  });
};

/* autosave */
vidaChecks.forEach(id=>{
  document.getElementById(id).addEventListener("change",salvar);
});
 /* ===== EXTENS√ïES FINAIS (SEGURAS) ===== */

let sono = 0;

/* Sono */
function alterarSono(v){
  sono = Math.max(0, sono + v);
  document.getElementById("sonoAtual").textContent = sono;
  salvar();
}

/* Condi√ß√µes exclusivas */
function syncCondicoes(){
  if(ferido.checked) caido.checked = false;
  if(caido.checked) ferido.checked = false;
}

/* salvar estendido */
const salvarBase = salvar;
salvar = function(){
  salvarBase();
  const d = JSON.parse(localStorage.getItem("noir")) || {};
  d.sono = sono;
  d.dinheiro = dinheiro.value;
  d.traumas = traumas.value;
  d.vantagens = vantagens.value;
  d.vidaChecks = [vidaChk1.checked, vidaChk2.checked, vidaChk3.checked];
  d.ferido = ferido.checked;
  d.caido = caido.checked;
  localStorage.setItem("noir", JSON.stringify(d));
};

/* carregar estendido */
const carregarBase = carregar;
carregar = function(){
  carregarBase();
  const d = JSON.parse(localStorage.getItem("noir"));
  if(!d) return;

  sono = d.sono || 0;
  sonoAtual.textContent = sono;

  dinheiro.value = d.dinheiro || "";
  traumas.value = d.traumas || "";
  vantagens.value = d.vantagens || "";

  if(d.vidaChecks){
    [vidaChk1,vidaChk2,vidaChk3].forEach((c,i)=>c.checked=d.vidaChecks[i]);
  }

  ferido.checked = !!d.ferido;
  caido.checked = !!d.caido;
};

/* eventos */
[vidaChk1,vidaChk2,vidaChk3,ferido,caido,traumas,vantagens,dinheiro]
.forEach(el=>{
  el.addEventListener("change",salvar);
  el.addEventListener("input",salvar);
});

ferido.addEventListener("change",syncCondicoes);
caido.addEventListener("change",syncCondicoes);
</script>
</body>
</html>
